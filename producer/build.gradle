import java.nio.file.Files

def outputFile = project.layout.buildDirectory.dir("some-subdir").map { it.file("shared-file.txt") }
def makeFile = tasks.register("makeFile", DefaultTask) {
    it.outputs.file(outputFile)
    it.doFirst {
        Files.writeString(outputFile.get().asFile.toPath(), "This file is shared across Gradle subprojects.")
    }
}

configurations {
    sharedConfiguration {
        canBeConsumed = true
        canBeResolved = false
    }
}

artifacts {
    sharedConfiguration(makeFile.map { task -> task.outputs.files.singleFile })
}
